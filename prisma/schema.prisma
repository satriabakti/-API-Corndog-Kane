// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("ADAPTER_PRISMA_POSTGRES_URL")
}
// Enums used across the schema

enum MeritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}
// User authentication and authorization models

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  name      String?
  password  String
  role_id   Int
  role      Role     @relation(fields: [role_id], references: [id])
  outlets   Outlet?
  is_active Boolean  @default(true)
  logins    Login[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("users")
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  users       User[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@map("roles")
}

model Login {
  id        Int      @id @default(autoincrement())
  user_id   Int
  user      User     @relation(fields: [user_id], references: [id])
  ip_address String
  user_agent String
  login_at   DateTime @default(now())
  is_active  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("user_logins")
}
// Outlet management models

model Outlet {
  id             Int             @id @default(autoincrement())
  name           String
  location       String
  code           String          @default(uuid()) @unique
  pic_phone      String
  description    String?
  check_in_time  String
  check_out_time String
  salary         Int
  is_active      Boolean         @default(true)
  user_id        Int             @unique
  user           User            @relation(fields: [user_id], references: [id])
  outlet_employee OutletEmployee[]
  orders         Order[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  product_requests       OutletProductRequest[]
  material_requests      OutletMaterialRequest[]
  @@map("outlets")
}

model OutletEmployee {
  id          Int      @id @default(autoincrement())
  outlet_id   Int
  employee_id Int
  assigned_at DateTime @default(now())
  outlet      Outlet   @relation(fields: [outlet_id], references: [id])
  employee    Employee @relation(fields: [employee_id], references: [id])
  is_active   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("outlet_employees")
}
model OutletProductRequest{
  id        Int      @id @default(autoincrement())
  outlet_id Int
  product_id Int
  quantity   Int
  approval_quantity Int?
  outlet    Outlet   @relation(fields: [outlet_id], references: [id])
  product   Product  @relation(fields: [product_id], references: [id])
  status    String   @default("PENDING")

  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outlet_requests")
}
enum OUTLETREQUESTSTATUS {
  PENDING
  APPROVED
  REJECTED
  FULFILLED
}
model OutletMaterialRequest{
  id        Int      @id @default(autoincrement())
  outlet_id Int
  material_id Int
  quantity   Int
  approval_quantity Int?
  outlet    Outlet   @relation(fields: [outlet_id], references: [id])
  material   material  @relation(fields: [material_id], references: [id])
  status    OUTLETREQUESTSTATUS @default(PENDING)

  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outlet_material_requests")
}
model Product {
  id              Int             @id @default(autoincrement())
  name            String
  image_path      String?
  description     String?
  price           Float
  category_id     Int
  category        ProductCategory @relation(fields: [category_id], references: [id])
  is_active       Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  order_items     OrderItem[]
  stocks          ProductStock[] 
  requests       OutletProductRequest[]
  @@map("products")
}
enum PRODUCTSOURCE  {
  PRODUCTION
  PURCHASE
}
model ProductStock{
  id  Int @id @default(autoincrement())
  product_id Int
  products Product @relation(fields: [product_id], references: [id])
  quantity Int @default(0)
  date     DateTime
  source_from PRODUCTSOURCE @default(PRODUCTION)

  detail   ProductStockDetail?
  @@map("product_stocs")
}
model ProductStockDetail{
  id  Int @id @default(autoincrement())
  stock_id  Int @unique
  price     Float
  supplier_id Int
  supplier   Supplier @relation(fields: [supplier_id], references: [id])
  stock     ProductStock @relation(fields: [stock_id],references: [id])
  @@map("product_stock_detail")
}

model ProductCategory {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  is_active Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]

  @@map("product_categories")
}



model Order {
  id             Int         @id @default(autoincrement())
  outlet_id      Int
  outlet_location String
  invoice_number  String      @unique
  employee_id    Int
  payment_method String
  total_amount   Int
  status         String      @default("PENDING")
  is_active      Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  items          OrderItem[]
  outlet         Outlet      @relation(fields: [outlet_id], references: [id])
  employee       Employee    @relation(fields: [employee_id], references: [id])

  @@map("orders")
}

model OrderItem {
  id         Int      @id @default(autoincrement())
  order_id   Int
  product_id Int
  quantity   Int
  price      Float
  order      Order    @relation(fields: [order_id], references: [id])
  product    Product  @relation(fields: [product_id], references: [id])
  is_active  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("order_items")
}
// Employee and human resource models

model Employee {
  id              Int              @id @default(autoincrement())
  name            String
  phone           String
  nik             String           @unique
  address         String
  province_id     Int
  city_id         Int
  district_id     Int
  subdistrict_id  Int
  merital_status  MeritalStatus
  religion        String
  birth_date      DateTime
  hire_date       DateTime
  is_active       Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  payroll         Payroll[]
  outlet_employee OutletEmployee[]
  orders          Order[]

  @@map("employees")
}

model Payroll {
  id          Int      @id @default(autoincrement())
  employee_id Int
  salary      Float
  bonus       Float    @default(0)
  deductions  Float    @default(0)
  pay_date    DateTime @default(now())
  employee    Employee @relation(fields: [employee_id], references: [id])
  is_active   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employee_payrolls")
}
// Warehouse and material management models

model Supplier {
  id        Int        @id @default(autoincrement())
  name      String
  phone     String     @unique
  address   String?
  is_active Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  materials  material[]
  product ProductStockDetail[]
  @@map("supliers")
}

model material {
  id           Int           @id @default(autoincrement())
  suplier_id   Int
  suplier      Supplier       @relation(fields: [suplier_id], references: [id])
  name         String
  is_active    Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  material_in  MaterialIn[]
  material_out MaterialOut[]
  requests     OutletMaterialRequest[]
  @@map("materials")
}

model MaterialIn {
  id            Int      @id @default(autoincrement())
  material_id   Int
  price         Int
  quantity_unit String
  quantity      Int
  material      material @relation(fields: [material_id], references: [id])
  received_at   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("material_ins")
}

model MaterialOut {
  id            Int      @id @default(autoincrement())
  material_id   Int
  quantity_unit String
  quantity      Int
  material      material @relation(fields: [material_id], references: [id])
  used_at       DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("material_outs")
}
