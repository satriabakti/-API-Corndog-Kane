// ============================================================================
// PRISMA SCHEMA - CORNDOG-KANE API
// ============================================================================
// This schema is organized by business modules for better maintainability.
// 
// BUSINESS MODULE ORGANIZATION:
// 
// üìã CORE MODULE (Lines ~30-145)
//    - Enums: Shared business enums
//    - Auth: User, Role, Login (Authentication & Authorization)
//    - Products: Product, ProductCategory (Master catalog)
//
// üë• HR MODULE (Lines ~146-195)
//    - Employee: Employee profiles
//    - Payroll: Employee payroll records
//
// üì¶ WAREHOUSE MODULE (Lines ~196-285)
//    - Suppliers: Supplier management
//    - Materials: material, MaterialIn, MaterialOut (Raw materials)
//    - Inventory: ProductStock, ProductStockDetail (Finished goods)
//
// üè™ OUTLETS MODULE (Lines ~286-340)
//    - Outlets: Outlet, OutletEmployee (Store management)
//    - Attendance: Employee attendance tracking
//
// üí∞ POS MODULE (Lines ~341-370)
//    - Sales: Order, OrderItem (Point of sale transactions)
//
// üöö SCM MODULE (Lines ~371-388)
//    - Requests: OutletProductRequest, OutletMaterialRequest (Supply chain)
//
// See SCHEMA_ORGANIZATION.md for detailed documentation.
// ============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("ADAPTER_PRISMA_POSTGRES_URL")
}

// ============================================================================
// CORE MODULE - Enums
// ============================================================================

enum MeritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum OUTLETREQUESTSTATUS {
  PENDING
  APPROVED
  REJECTED
  FULFILLED
}

enum PRODUCTSOURCE {
  PRODUCTION
  PURCHASE
}

enum BagSize {
  SMALL
  MEDIUM
  LARGE
}

enum PackagingType {
  CUP
  BOX
  NONE
}

// ============================================================================
// CORE MODULE - Authentication & Authorization
// ============================================================================

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  name      String?
  password  String
  role_id   Int
  role      Role     @relation(fields: [role_id], references: [id])
  outlets   Outlet?
  is_active Boolean  @default(true)
  logins    Login[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  is_active   Boolean  @default(true)
  users       User[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("roles")
}

model Login {
  id         Int      @id @default(autoincrement())
  user_id    Int
  user       User     @relation(fields: [user_id], references: [id])
  ip_address String
  user_agent String
  login_at   DateTime @default(now())
  is_active  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("user_logins")
}

// ============================================================================
// CORE MODULE - Product Master Data
// ============================================================================
model ProductMaster {
  id          Int                   @id @default(autoincrement())
  name        String  
  category_id Int
  category    ProductCategory        @relation(fields: [category_id], references: [id])
  is_active   Boolean                @default(true)
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  products    Product[]
  inventories ProductInventory[]
  stocks      ProductStock[]

  @@map("product_masters")
}

model Product {
  id          Int                    @id @default(autoincrement())
  image_path  String?
  description String?
  price       Float
  hpp         Float?                 @default(0)
  product_master_id  Int
  product_master ProductMaster @relation(fields: [product_master_id], references: [id])
  is_active   Boolean                @default(true)
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  order_items OrderItem[]
  requests    OutletProductRequest[]
  @@map("product_menus")
}

model ProductInventory{
  id         Int      @id @default(autoincrement())
  product_id Int
  quantity   Int
  material_id Int
  unit_quantity String
  material   material @relation(fields: [material_id], references: [id])
  product    ProductMaster  @relation(fields: [product_id], references: [id])
  createdAt   DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("product_inventories")
}

model ProductCategory {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  is_active Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  ProductMaster[]

  @@map("product_categories")
}

// ============================================================================
// HR MODULE - Employee Management & Payroll
// ============================================================================

enum BLOODTYPE {
  A
  B
  AB
  O
}
enum Gender {
  MALE
  FEMALE
}
model Employee {
  id              Int              @id @default(autoincrement())
  nik             String           @unique
  name            String
  phone           String
  address         String
  province_id     BigInt
  city_id         BigInt
  district_id     BigInt
  subdistrict_id  BigInt
  merital_status  MeritalStatus
  religion        String
  birth_date      DateTime
  birth_place     String
  blood_type      BLOODTYPE 
  rt              String
  rw              String
  work_type      String
  position        String
  notes           String?
  image_path      String
  gender          Gender
  hire_date       DateTime
  is_active       Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  payroll         Payroll[]
  payment_batches PaymentBatch[]
  outlet_employee OutletEmployee[]
  orders          Order[]
  attendances     Attendance[]

  @@map("employees")
}

enum PaymentStatus {
  PENDING
  PROCESSING
  PAID
  CANCELLED
}

enum BonusType {
  TARGET_ACHIEVEMENT
  MANUAL
  PERFORMANCE
  ATTENDANCE
  OTHER
}

enum DeductionType {
  LATE
  ABSENT
  LOAN
  INSURANCE
  TAX
  OTHER
}

model Payroll {
  id                Int                 @id @default(autoincrement())
  employee_id       Int
  outlet_id         Int
  attendance_id     Int?
  base_salary       Float
  total_bonus       Float               @default(0)
  total_deduction   Float               @default(0)
  final_salary      Float
  work_date         DateTime
  payment_batch_id  Int?
  employee          Employee            @relation(fields: [employee_id], references: [id])
  outlet            Outlet              @relation(fields: [outlet_id], references: [id])
  attendance        Attendance?         @relation(fields: [attendance_id], references: [id])
  payment_batch     PaymentBatch?       @relation(fields: [payment_batch_id], references: [id])
  bonuses           PayrollBonus[]
  deductions        PayrollDeduction[]
  is_active         Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([employee_id, work_date])
  @@index([outlet_id, work_date])
  @@index([payment_batch_id])
  @@map("employee_payrolls")
}

model PaymentBatch {
  id                Int             @id @default(autoincrement())
  employee_id       Int
  period_start      DateTime
  period_end        DateTime
  total_base_salary Float
  total_bonus       Float           @default(0)
  total_deduction   Float           @default(0)
  final_amount      Float
  status            PaymentStatus   @default(PENDING)
  paid_at           DateTime?
  payment_method    String?
  payment_reference String?
  notes             String?
  employee          Employee        @relation(fields: [employee_id], references: [id])
  payrolls          Payroll[]
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([employee_id, period_start, period_end])
  @@index([status])
  @@map("payment_batches")
}

model PayrollBonus {
  id          Int      @id @default(autoincrement())
  payroll_id  Int
  type        BonusType
  amount      Float
  description String?
  reference   String?
  payroll     Payroll  @relation(fields: [payroll_id], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([payroll_id])
  @@map("payroll_bonuses")
}

model PayrollDeduction {
  id          Int           @id @default(autoincrement())
  payroll_id  Int
  type        DeductionType
  amount      Float
  description String?
  reference   String?
  payroll     Payroll       @relation(fields: [payroll_id], references: [id], onDelete: Cascade)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([payroll_id])
  @@map("payroll_deductions")
}

// ============================================================================
// WAREHOUSE MODULE - Supplier Management
// ============================================================================

model Supplier {
  id        Int                  @id @default(autoincrement())
  name      String
  phone     String               @unique
  address   String?
  is_active Boolean              @default(true)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  materials material[]
  product   ProductStockDetail[]

  @@map("supliers")
}

// ============================================================================
// WAREHOUSE MODULE - Raw Materials Management
// ============================================================================

model material {
  id           Int                     @id @default(autoincrement())
  suplier_id   Int
  suplier      Supplier                @relation(fields: [suplier_id], references: [id])
  name         String
  is_active    Boolean                 @default(true)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  material_in  MaterialIn[]
  material_out MaterialOut[]
  requests     OutletMaterialRequest[]
  products     ProductInventory[]
  order_usages OrderMaterialUsage[]
  @@map("materials")
}

model MaterialIn {
  id            Int      @id @default(autoincrement())
  material_id   Int
  price         Int
  quantity_unit String
  quantity      Int
  material      material @relation(fields: [material_id], references: [id])
  received_at   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("material_ins")
}

model MaterialOut {
  id            Int      @id @default(autoincrement())
  material_id   Int
  quantity_unit String
  quantity      Int
  material      material @relation(fields: [material_id], references: [id])
  used_at       DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("material_outs")
}

// ============================================================================
// WAREHOUSE MODULE - Finished Goods Inventory
// ============================================================================

model ProductStock {
  id          Int           @id @default(autoincrement())
  product_id  Int
  products    ProductMaster @relation(fields: [product_id], references: [id])
  is_active   Boolean      @default(true)
  units       String       @default("pcs")
  quantity    Int           @default(0)
  date        DateTime
  source_from PRODUCTSOURCE @default(PRODUCTION)

  detail ProductStockDetail?

  @@map("product_stocs")
}

model ProductStockDetail {
  id          Int          @id @default(autoincrement())
  stock_id    Int          @unique
  price       Float
  supplier_id Int
  supplier    Supplier     @relation(fields: [supplier_id], references: [id])
  stock       ProductStock @relation(fields: [stock_id], references: [id])

  @@map("product_stock_detail")
}

// ============================================================================
// OUTLETS MODULE - Store/Branch Management
// ============================================================================

model Outlet {
  id                Int                     @id @default(autoincrement())
  name              String
  location          String
  code              String                  @unique @default(uuid())
  description       String?
  income_target     Int                     @default(0) 
  is_active         Boolean                 @default(true)
  user_id           Int                     @unique
  user              User                    @relation(fields: [user_id], references: [id])
  outlet_employee   OutletEmployee[]
  orders            Order[]
  payrolls          Payroll[]
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  product_requests  OutletProductRequest[]
  material_requests OutletMaterialRequest[]
  attendances       Attendance[]
  settings          OutletSetting[]

  @@map("outlets")
}
enum DAY {
  MONDAY
  SUNDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}
model OutletSetting {
  id              Int @id @default(autoincrement())
  outlet_id       Int
  check_in_time   String
  check_out_time  String
  salary          Int
  day             DAY[]
  outlet          Outlet @relation(fields: [outlet_id], references: [id], onDelete: Cascade,onUpdate: Cascade)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  @@map("outlet_settings")
}


model OutletEmployee {
  id          Int      @id @default(autoincrement())
  outlet_id   Int
  employee_id Int
  assigned_at DateTime @default(now())

  outlet      Outlet   @relation(fields: [outlet_id], references: [id])
  employee    Employee @relation(fields: [employee_id], references: [id])
  is_active   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("outlet_employees")
}

// ============================================================================
// OUTLETS MODULE - Employee Attendance Tracking
// ============================================================================
enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}
enum AttendanceStatus {
  PRESENT
  SICK
  NOT_PRESENT
  EXCUSED
  CUTI
}
model Attendance {
  id                   Int       @id @default(autoincrement())
  employee_id          Int
  outlet_id            Int
  checkin_image_proof  String
  checkout_image_proof String?
  checkin_time         DateTime  @default(now())
  checkout_time        DateTime?
  late_minutes        Int       @default(0)
  late_notes          String?
  late_present_proof  String?
  late_approval_status ApprovalStatus @default(PENDING)
  attendance_status   AttendanceStatus @default(PRESENT)
  notes               String?
  is_active            Boolean   @default(true)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // Relations
  employee Employee @relation(fields: [employee_id], references: [id])
  outlet   Outlet   @relation(fields: [outlet_id], references: [id])
  payrolls Payroll[]

  // Indexes for common queries
  @@index([employee_id, checkin_time])
  @@index([outlet_id, checkin_time])
  @@index([checkin_time])
  @@map("attendances")
}

// ============================================================================
// POS MODULE - Point of Sale & Sales Transactions
// ============================================================================

model Order {
  id              Int                   @id @default(autoincrement())
  outlet_id       Int
  outlet_location String
  invoice_number  String                @unique
  employee_id     Int
  payment_method  String
  total_amount    Int
  status          String                @default("PENDING")
  is_using_bag    BagSize?
  packaging_type  PackagingType?
  is_active       Boolean               @default(true)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  items           OrderItem[]
  material_usage  OrderMaterialUsage[]
  outlet          Outlet                @relation(fields: [outlet_id], references: [id])
  employee        Employee              @relation(fields: [employee_id], references: [id])

  @@map("orders")
}


model OrderItem {
  id         Int      @id @default(autoincrement())
  order_id   Int
  product_id Int
  quantity   Int
  price      Float
  order_item_root_id Int?
  order      Order    @relation(fields: [order_id], references: [id])
  product    Product  @relation(fields: [product_id], references: [id])
  order_item_root OrderItem? @relation("OrderItemSelfRelation", fields: [order_item_root_id], references: [id])
  sub_items       OrderItem[] @relation("OrderItemSelfRelation")
  is_active  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("order_items")
}

model OrderMaterialUsage {
  id            Int      @id @default(autoincrement())
  order_id      Int
  material_id   Int
  quantity      Int
  quantity_unit String
  used_at       DateTime @default(now())
  order         Order    @relation(fields: [order_id], references: [id])
  material      material @relation(fields: [material_id], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("order_material_usages")
}

// ============================================================================
// SCM MODULE - Supply Chain Management & Distribution Requests
// ============================================================================
// Supply Chain Management - Outlet requests for products and materials

model OutletProductRequest {
  id                Int     @id @default(autoincrement())
  outlet_id         Int
  product_id        Int
  quantity          Int
  approval_quantity Int?
  outlet            Outlet  @relation(fields: [outlet_id], references: [id])
  product           Product @relation(fields: [product_id], references: [id])
  status            String  @default("PENDING")

  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outlet_requests")
}

model OutletMaterialRequest {
  id                Int                 @id @default(autoincrement())
  outlet_id         Int
  material_id       Int
  quantity          Int
  approval_quantity Int?
  outlet            Outlet              @relation(fields: [outlet_id], references: [id])
  material          material            @relation(fields: [material_id], references: [id])
  status            OUTLETREQUESTSTATUS @default(PENDING)

  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outlet_material_requests")
}

// // ============================================================================
// FINANCE MODULE - Chart of Accounts & Transaction Management
// ============================================================================

enum TransactionType {
  INCOME
  EXPENSE
}

model Account {
  id                  Int                 @id @default(autoincrement())
  name                String
  number              String              @unique
  balance             Float               @default(0)
  description         String?
  account_category_id Int
  account_category    AccountCategory     @relation(fields: [account_category_id], references: [id])
  transactions        Transaction[]
  is_active           Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  account_type_id     Int
  account_type        AccountType         @relation(fields: [account_type_id], references: [id])

  @@index([account_category_id])
  @@map("accounts")
}

model AccountCategory {
  id            Int           @id @default(autoincrement())
  name          String        @unique
  description   String?
  is_active     Boolean       @default(true)
  accounts      Account[]
  account_types AccountType[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("account_categories")
}
model AccountType {
  id                  Int             @id @default(autoincrement())
  name                String          @unique
  code                String?         @unique
  description         String?
  account_category_id Int
  account_category    AccountCategory @relation(fields: [account_category_id], references: [id])
  is_active           Boolean         @default(true)
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  accounts            Account[]

  @@map("account_types")
}
model Transaction {
  id               Int             @id @default(autoincrement())
  account_id       Int
  amount           Float
  transaction_type TransactionType
  description      String?
  transaction_date DateTime        @default(now())
  reference_number String?
  account          Account         @relation(fields: [account_id], references: [id])
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  @@index([transaction_date])
  @@index([account_id, transaction_date])
  @@map("transactions")
}
