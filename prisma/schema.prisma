// ============================================================================
// PRISMA SCHEMA - CORNDOG-KANE API
// ============================================================================
// This schema is organized by business modules for better maintainability.
// 
// BUSINESS MODULE ORGANIZATION:
// 
// ðŸ“‹ CORE MODULE (Lines ~30-145)
//    - Enums: Shared business enums
//    - Auth: User, Role, Login (Authentication & Authorization)
//    - Products: Product, ProductCategory (Master catalog)
//
// ðŸ‘¥ HR MODULE (Lines ~146-195)
//    - Employee: Employee profiles
//    - Payroll: Employee payroll records
//
// ðŸ“¦ WAREHOUSE MODULE (Lines ~196-285)
//    - Suppliers: Supplier management
//    - Materials: material, MaterialIn, MaterialOut (Raw materials)
//    - Inventory: ProductStock, ProductStockDetail (Finished goods)
//
// ðŸª OUTLETS MODULE (Lines ~286-340)
//    - Outlets: Outlet, OutletEmployee (Store management)
//    - Attendance: Employee attendance tracking
//
// ðŸ’° POS MODULE (Lines ~341-370)
//    - Sales: Order, OrderItem (Point of sale transactions)
//
// ðŸšš SCM MODULE (Lines ~371-388)
//    - Requests: OutletProductRequest, OutletMaterialRequest (Supply chain)
//
// See SCHEMA_ORGANIZATION.md for detailed documentation.
// ============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("ADAPTER_PRISMA_POSTGRES_URL")
}

// ============================================================================
// CORE MODULE - Enums
// ============================================================================

enum MeritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum OUTLETREQUESTSTATUS {
  PENDING
  APPROVED
  REJECTED
  FULFILLED
}

enum PRODUCTSOURCE {
  PRODUCTION
  PURCHASE
}

enum BagSize {
  SMALL
  MEDIUM
  LARGE
}

enum PackagingType {
  CUP
  BOX
  NONE
}

// ============================================================================
// CORE MODULE - Authentication & Authorization
// ============================================================================

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  name      String?
  password  String
  role_id   Int
  role      Role     @relation(fields: [role_id], references: [id])
  outlets   Outlet?
  is_active Boolean  @default(true)
  logins    Login[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Role {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  is_active   Boolean  @default(true)
  users       User[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("roles")
}

model Login {
  id         Int      @id @default(autoincrement())
  user_id    Int
  user       User     @relation(fields: [user_id], references: [id])
  ip_address String
  user_agent String
  login_at   DateTime @default(now())
  is_active  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("user_logins")
}

// ============================================================================
// CORE MODULE - Product Master Data
// ============================================================================
model ProductMaster {
  id          Int                   @id @default(autoincrement())
  name        String  
  category_id Int
  category    ProductCategory        @relation(fields: [category_id], references: [id])
  is_active   Boolean                @default(true)
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  products    Product[]
  inventories ProductInventory[]
  stocks      ProductStock[]

  @@map("product_masters")
}

model Product {
  id          Int                    @id @default(autoincrement())
  image_path  String?
  description String?
  price       Float
  hpp         Float?                 @default(0)
  product_master_id  Int
  product_master ProductMaster @relation(fields: [product_master_id], references: [id])
  is_active   Boolean                @default(true)
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  order_items OrderItem[]
  requests    OutletProductRequest[]
  @@map("product_menus")
}

model ProductInventory{
  id         Int      @id @default(autoincrement())
  product_id Int
  quantity   Int
  material_id Int
  unit_quantity String
  material   material @relation(fields: [material_id], references: [id])
  product    ProductMaster  @relation(fields: [product_id], references: [id])
  createdAt   DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("product_inventories")
}

model ProductCategory {
  id        Int       @id @default(autoincrement())
  name      String    @unique
  is_active Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  ProductMaster[]

  @@map("product_categories")
}

// ============================================================================
// HR MODULE - Employee Management & Payroll
// ============================================================================

enum BLOODTYPE {
  A
  B
  AB
  O
}
enum Gender {
  MALE
  FEMALE
}
model Employee {
  id              Int              @id @default(autoincrement())
  nik             String           @unique
  name            String
  phone           String
  address         String
  province_id     BigInt
  city_id         BigInt
  district_id     BigInt
  subdistrict_id  BigInt
  merital_status  MeritalStatus
  religion        String
  birth_date      DateTime
  birth_place     String
  blood_type      BLOODTYPE 
  rt              String
  rw              String
  work_type      String
  position        String
  notes           String?
  image_path      String
  gender          Gender
  hire_date       DateTime
  is_active       Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  payroll         Payroll[]
  outlet_employee OutletEmployee[]
  orders          Order[]
  attendances     Attendance[]

  @@map("employees")
}

model Payroll {
  id          Int      @id @default(autoincrement())
  employee_id Int
  salary      Float
  bonus       Float    @default(0)
  deductions  Float    @default(0)
  pay_date    DateTime @default(now())
  employee    Employee @relation(fields: [employee_id], references: [id])
  is_active   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employee_payrolls")
}

// ============================================================================
// WAREHOUSE MODULE - Supplier Management
// ============================================================================

model Supplier {
  id        Int                  @id @default(autoincrement())
  name      String
  phone     String               @unique
  address   String?
  is_active Boolean              @default(true)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  materials material[]
  product   ProductStockDetail[]

  @@map("supliers")
}

// ============================================================================
// WAREHOUSE MODULE - Raw Materials Management
// ============================================================================

model material {
  id           Int                     @id @default(autoincrement())
  suplier_id   Int
  suplier      Supplier                @relation(fields: [suplier_id], references: [id])
  name         String
  is_active    Boolean                 @default(true)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  material_in  MaterialIn[]
  material_out MaterialOut[]
  requests     OutletMaterialRequest[]
  products     ProductInventory[]
  order_usages OrderMaterialUsage[]
  @@map("materials")
}

model MaterialIn {
  id            Int      @id @default(autoincrement())
  material_id   Int
  price         Int
  quantity_unit String
  quantity      Int
  material      material @relation(fields: [material_id], references: [id])
  received_at   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("material_ins")
}

model MaterialOut {
  id            Int      @id @default(autoincrement())
  material_id   Int
  quantity_unit String
  quantity      Int
  material      material @relation(fields: [material_id], references: [id])
  used_at       DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("material_outs")
}

// ============================================================================
// WAREHOUSE MODULE - Finished Goods Inventory
// ============================================================================

model ProductStock {
  id          Int           @id @default(autoincrement())
  product_id  Int
  products    ProductMaster @relation(fields: [product_id], references: [id])
  is_active   Boolean      @default(true)
  units       String       @default("pcs")
  quantity    Int           @default(0)
  date        DateTime
  source_from PRODUCTSOURCE @default(PRODUCTION)

  detail ProductStockDetail?

  @@map("product_stocs")
}

model ProductStockDetail {
  id          Int          @id @default(autoincrement())
  stock_id    Int          @unique
  price       Float
  supplier_id Int
  supplier    Supplier     @relation(fields: [supplier_id], references: [id])
  stock       ProductStock @relation(fields: [stock_id], references: [id])

  @@map("product_stock_detail")
}

// ============================================================================
// OUTLETS MODULE - Store/Branch Management
// ============================================================================

model Outlet {
  id                Int                     @id @default(autoincrement())
  name              String
  location          String
  code              String                  @unique @default(uuid())
  description       String?
  income_target     Int                     @default(0) 
  is_active         Boolean                 @default(true)
  user_id           Int                     @unique
  user              User                    @relation(fields: [user_id], references: [id])
  outlet_employee   OutletEmployee[]
  orders            Order[]
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  product_requests  OutletProductRequest[]
  material_requests OutletMaterialRequest[]
  attendances       Attendance[]
  settings          OutletSetting[]

  @@map("outlets")
}
enum DAY {
  MONDAY
  SUNDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}
model OutletSetting {
  id              Int @id @default(autoincrement())
  outlet_id       Int
  check_in_time   String
  check_out_time  String
  salary          Int
  day             DAY[]
  outlet          Outlet @relation(fields: [outlet_id], references: [id], onDelete: Cascade,onUpdate: Cascade)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  @@map("outlet_settings")
}


model OutletEmployee {
  id          Int      @id @default(autoincrement())
  outlet_id   Int
  employee_id Int
  assigned_at DateTime @default(now())

  outlet      Outlet   @relation(fields: [outlet_id], references: [id])
  employee    Employee @relation(fields: [employee_id], references: [id])
  is_active   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("outlet_employees")
}

// ============================================================================
// OUTLETS MODULE - Employee Attendance Tracking
// ============================================================================
enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}
enum AttendanceStatus {
  PRESENT
  SICK
  NOT_PRESENT
  EXCUSED
  CUTI
}
model Attendance {
  id                   Int       @id @default(autoincrement())
  employee_id          Int
  outlet_id            Int
  checkin_image_proof  String
  checkout_image_proof String?
  checkin_time         DateTime  @default(now())
  checkout_time        DateTime?
  late_minutes        Int       @default(0)
  late_notes          String?
  late_present_proof  String?
  late_approval_status ApprovalStatus @default(PENDING)
  attendance_status   AttendanceStatus @default(PRESENT)
  notes               String?
  is_active            Boolean   @default(true)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // Relations
  employee Employee @relation(fields: [employee_id], references: [id])
  outlet   Outlet   @relation(fields: [outlet_id], references: [id])

  // Indexes for common queries
  @@index([employee_id, checkin_time])
  @@index([outlet_id, checkin_time])
  @@index([checkin_time])
  @@map("attendances")
}

// ============================================================================
// POS MODULE - Point of Sale & Sales Transactions
// ============================================================================

model Order {
  id              Int                   @id @default(autoincrement())
  outlet_id       Int
  outlet_location String
  invoice_number  String                @unique
  employee_id     Int
  payment_method  String
  total_amount    Int
  status          String                @default("PENDING")
  is_using_bag    BagSize?
  packaging_type  PackagingType?
  is_active       Boolean               @default(true)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  items           OrderItem[]
  material_usage  OrderMaterialUsage[]
  outlet          Outlet                @relation(fields: [outlet_id], references: [id])
  employee        Employee              @relation(fields: [employee_id], references: [id])

  @@map("orders")
}


model OrderItem {
  id         Int      @id @default(autoincrement())
  order_id   Int
  product_id Int
  quantity   Int
  price      Float
  order_item_root_id Int?
  order      Order    @relation(fields: [order_id], references: [id])
  product    Product  @relation(fields: [product_id], references: [id])
  order_item_root OrderItem? @relation("OrderItemSelfRelation", fields: [order_item_root_id], references: [id])
  sub_items       OrderItem[] @relation("OrderItemSelfRelation")
  is_active  Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("order_items")
}

model OrderMaterialUsage {
  id            Int      @id @default(autoincrement())
  order_id      Int
  material_id   Int
  quantity      Int
  quantity_unit String
  used_at       DateTime @default(now())
  order         Order    @relation(fields: [order_id], references: [id])
  material      material @relation(fields: [material_id], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("order_material_usages")
}

// ============================================================================
// SCM MODULE - Supply Chain Management & Distribution Requests
// ============================================================================
// Supply Chain Management - Outlet requests for products and materials

model OutletProductRequest {
  id                Int     @id @default(autoincrement())
  outlet_id         Int
  product_id        Int
  quantity          Int
  approval_quantity Int?
  outlet            Outlet  @relation(fields: [outlet_id], references: [id])
  product           Product @relation(fields: [product_id], references: [id])
  status            String  @default("PENDING")

  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outlet_requests")
}

model OutletMaterialRequest {
  id                Int                 @id @default(autoincrement())
  outlet_id         Int
  material_id       Int
  quantity          Int
  approval_quantity Int?
  outlet            Outlet              @relation(fields: [outlet_id], references: [id])
  material          material            @relation(fields: [material_id], references: [id])
  status            OUTLETREQUESTSTATUS @default(PENDING)

  is_active Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("outlet_material_requests")
}

//analize this schema for coa Finance for the endpoint is 
//1. /finannce/accounts -> crud and get all of account can be filtered by category
//2. /finance/acccount-categories -> getr all account category
//3. /finance/transaction must be crud and get all of transaction for createing must be date,account_id,type,amount,description with updated to balance on account, for get all of transaction must be  date,account_name,account_id,description,amount of credit, amount of debit

//4. ./finance/reports?type=table|pdf|xlsx&start_date&end_date&account_category_ids=1,2,3 on the table type must be  grup the transaction on same date  with the field date,account_name,account_id,description,income_amount,expence_amount, and up 1 level is total of saldo with sum 


// finance
//model Account{
//  id          Int      @id @default(autoincrement())
//  name        String
//  number      String   @unique
//  balance     Float    @default(0)
//  description String?
//  account_category_id Int
//  account_category    AccountCategory @relation(fields: [account_category_id], references: [id])
//  transactions Transaction[]
//  is_active   Boolean  @default(true)
 // createdAt   DateTime @default(now())
//  updatedAt   DateTime @updatedAt


//}
//model AccountCategory{
//  id          Int      @id @default(autoincrement())
//  name        String   @unique
 // description String?
//  is_active   Boolean  @default(true)
//  accounts     Account[]
//  createdAt   DateTime @default(now())
//  updatedAt   DateTime @updatedAt
//  
//}
//enum TransactionType {
//  INCOME
//  EXPENSE
//}
//model Transaction{
//  id              Int      @id @default(autoincrement())
//  account_id      Int
//  amount          Float
//  transaction_type TransactionType
//  description     String?
//  transaction_date DateTime @default(now())
//
//  account         Account  @relation(fields: [account_id], references: [id])
//  createdAt       DateTime @default(now())
//  updatedAt       DateTime @updatedAt
//
//}
//